#! /usr/bin/env bash
set -o errexit

if [[ $1 = -h ]]; then
	echo 'twitch-dl <id> <start-time> <(multi-word) title>'
	exit 0
fi

id=$1
time=$2
title=${*:3} # use 3rd arg+

dir="$title"
mkdir -p "$dir"
pushd "$dir" >/dev/null
set +o errexit # still popd if the download fails

time twitch_vod_fetch https://twitch.tv/videos/$id vid --start-pos $time --keep-tempfiles --create-part-file --aria2c-opts '--max-concurrent-downloads=5 --lowest-speed-limit=10K --rpc-listen-all'

popd >/dev/null
