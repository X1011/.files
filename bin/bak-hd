#! /usr/bin/env bash

dest='/media/dan/External Backup'

apt-mark showmanual > ~/.config/package-list.txt

pushd ~/.config/rsync >/dev/null

rsync-opt() {
	rsync --verbose --human-readable --progress --archive --prune-empty-dirs "$@" --exclude-from global.exclude
}

(
	rsync-opt {,"$dest/"}~/ --filter 'merge ./~.filter' --exclude-from ./~.exclude --delete-excluded "$@"
	rsync-opt {/,"$dest/"}etc/ --filter 'merge etc.filter' --delete-excluded "$@"
	rsync-opt ~/{video,photos,games} "$dest" "$@"

#  â†“ redirect stderr, too
) |& tee bak.log

popd >/dev/null
