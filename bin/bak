#! /usr/bin/env bash
set -o errexit

pacman --query --quiet --explicit > ~/bak/pkg-list.txt

pushd ~/.config/rclone >/dev/null

rclone-bak() {
	rclone --config=rclone.conf --verbose --drive-use-trash --delete-excluded sync "$@" 2>&1 \
	| egrep --invert-match \
	-e ': (Finished r|R)eading ' \
	-e 'pacer: Rate limited, ' \
	-e 'pacer: Resetting sleep to minimum ' \
	-e 'pacer: low level retry ' \
	-e 'Unchanged skipping' \
	-e 'Size and modification time the same' \
	-e 'Sending chunk' \
	-e ': (Sizes|Md5sums|Modification times) differ' \
	-e '\.config/xfce4/.+?: Size and MD5 of src and dst objects identical' \
	-e ': Excluded from sync \(and deletion\)' \
	-e "Can't transfer non file/directory"
	
	#-e '' \
}

rclone-bak {,drive:bak/linux}/etc --include-from=etc.include "$@" | tee etc.log
rclone-bak {,drive:bak/linux/}~   --filter-from=./~.filter   "$@" | tee ~.log

popd >/dev/null
