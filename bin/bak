#! /usr/bin/env bash
set -o errexit

#pacman --query --quiet --explicit > ~/bak/pkg-list.txt

pushd ~/.config/rclone >/dev/null

rclone-bak() {
	rclone --config=rclone.conf --verbose --drive-use-trash --delete-excluded --filter-from=global.filter sync "$@" 2>&1 \
	| egrep --invert-match \
	-e 'Size and MD5SUM of src and dst objects identical' \
	-e 'Unchanged skipping' \
	-e 'Size and modification time the same' \
	-e 'Sending chunk' \
	-e 'googleapi: Error 403: User rate limit exceeded, userRateLimitExceeded' \
	-e ': Reducing sleep to' \
	-e ': (Sizes|Md5sums|Modification times) differ'
}

rclone-bak {,drive:bak/linux/arch}/etc --exclude-from=etc.exclude --max-size=640k "$@"
rclone-bak {,drive:bak/linux/arch/}~   --exclude-from=./~.exclude --filter-from=./~.filter "$@"

# 	-e "Can't transfer non file/directory" \
# 	-e '' \

popd >/dev/null
